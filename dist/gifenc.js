var X=Object.defineProperty;var st=t=>X(t,"__esModule",{value:!0});var lt=(t,e)=>{for(var f in e)X(t,f,{get:e[f],enumerable:!0})};st(exports);lt(exports,{GIFEncoder:()=>ft,applyPalette:()=>rt,default:()=>yt,dither:()=>K,prequantize:()=>nt,quantize:()=>N});var $={signature:"GIF",version:"89a",trailer:59,extensionIntroducer:33,applicationExtensionLabel:255,graphicControlExtensionLabel:249,imageSeparator:44,signatureSize:3,versionSize:3,globalColorTableFlagMask:128,colorResolutionMask:112,sortFlagMask:8,globalColorTableSizeMask:7,applicationIdentifierSize:8,applicationAuthCodeSize:3,disposalMethodMask:28,userInputFlagMask:2,transparentColorFlagMask:1,localColorTableFlagMask:128,interlaceFlagMask:64,idSortFlagMask:32,localColorTableSizeMask:7};function V(t=256){let e=0,f=new Uint8Array(t);return{get buffer(){return f.buffer},reset(){e=0},bytesView(){return f.subarray(0,e)},bytes(){return f.slice(0,e)},writeByte(o){r(e+1),f[e]=o,e++},writeBytes(o,i=0,c=o.length){r(e+c);for(let l=0;l<c;l++)f[e++]=o[l+i]},writeBytesView(o,i=0,c=o.byteLength){r(e+c),f.set(o.subarray(i,i+c),e),e+=c}};function r(o){var i=f.length;if(i>=o)return;var c=1024*1024;o=Math.max(o,i*(i<c?2:1.125)>>>0),i!=0&&(o=Math.max(o,256));let l=f;f=new Uint8Array(o),e>0&&f.set(l.subarray(0,e),0)}}var Q=12,J=5003,at=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function ut(t,e,f,r,o=V(512),i=new Uint8Array(256),c=new Int32Array(J),l=new Int32Array(J)){let u=c.length,g=Math.max(2,r);i.fill(0),l.fill(0),c.fill(-1);let s=0,n=0,b=g+1,B=b,w=!1,y=B,p=(1<<y)-1,x=1<<b-1,U=x+1,A=x+2,h=0,M=f[0],C=0;for(let d=u;d<65536;d*=2)++C;C=8-C,o.writeByte(g),k(x);let _=f.length;for(let d=1;d<_;d++){t:{let z=f[d],E=(z<<Q)+M,I=z<<C^M;if(c[I]===E){M=l[I];break t}let R=I===0?1:u-I;for(;c[I]>=0;)if(I-=R,I<0&&(I+=u),c[I]===E){M=l[I];break t}k(M),M=z,A<1<<Q?(l[I]=A++,c[I]=E):(c.fill(-1),A=x+2,w=!0,k(x))}}return k(M),k(U),o.writeByte(0),o.bytesView();function k(d){for(s&=at[n],n>0?s|=d<<n:s=d,n+=y;n>=8;)i[h++]=s&255,h>=254&&(o.writeByte(h),o.writeBytesView(i,0,h),h=0),s>>=8,n-=8;if((A>p||w)&&(w?(y=B,p=(1<<y)-1,w=!1):(++y,p=y===Q?1<<y:(1<<y)-1)),d==U){for(;n>0;)i[h++]=s&255,h>=254&&(o.writeByte(h),o.writeBytesView(i,0,h),h=0),s>>=8,n-=8;h>0&&(o.writeByte(h),o.writeBytesView(i,0,h),h=0)}}}var tt=ut;function T(t,e,f){return t<<8&63488|e<<2&992|f>>3}function G(t,e,f,r){return t>>4|e&240|(f&240)<<4|(r&240)<<8}function D(t,e,f){return t>>4<<8|e&240|f>>4}function L(t,e,f,r,o){let i=0,c=1e100;for(let l=0;l<o.length;l++){let u=o[l],g=u[3],s=S(g-r);if(s>c)continue;let n=u[0];if(s+=S(n-t),s>c)continue;let b=u[1];if(s+=S(b-e),s>c)continue;let B=u[2];s+=S(B-f),!(s>c)&&(c=s,i=l)}return i}function Y(t,e,f,r){let o=0,i=1e100;for(let c=0;c<r.length;c++){let l=r[c],u=l[0],g=S(u-t);if(g>i)continue;let s=l[1];if(g+=S(s-e),g>i)continue;let n=l[2];g+=S(n-f),!(g>i)&&(i=g,o=c)}return o}function S(t){return t*t}function P(t,e,f){return t<e?e:t>f?f:t}function et(t,e,f){var r=0,o=1e100;let i=t[e],c=i.cnt,l=i.ac,u=i.rc,g=i.gc,s=i.bc;for(var n=i.fw;n!=0;n=t[n].fw){let B=t[n],w=B.cnt,y=c*w/(c+w);if(!(y>=o)){var b=0;f&&(b+=y*S(B.ac-l),b>=o)||(b+=y*S(B.rc-u),!(b>=o)&&(b+=y*S(B.gc-g),!(b>=o)&&(b+=y*S(B.bc-s),!(b>=o)&&(o=b,r=n))))}}i.err=o,i.nn=r}function H(){return{ac:0,rc:0,gc:0,bc:0,cnt:0,nn:0,fw:0,bk:0,tm:0,mtm:0,err:0}}function xt(t,e){let f=e==="rgb444"?4096:65536,r=new Array(f),o=t.length;if(e==="rgba4444")for(let i=0;i<o;++i){let c=t[i],l=c>>24&255,u=c>>16&255,g=c>>8&255,s=c&255,n=G(s,g,u,l),b=n in r?r[n]:r[n]=H();b.rc+=s,b.gc+=g,b.bc+=u,b.ac+=l,b.cnt++}else if(e==="rgb444")for(let i=0;i<o;++i){let c=t[i],l=c>>16&255,u=c>>8&255,g=c&255,s=D(g,u,l),n=s in r?r[s]:r[s]=H();n.rc+=g,n.gc+=u,n.bc+=l,n.cnt++}else for(let i=0;i<o;++i){let c=t[i],l=c>>16&255,u=c>>8&255,g=c&255,s=T(g,u,l),n=s in r?r[s]:r[s]=H();n.rc+=g,n.gc+=u,n.bc+=l,n.cnt++}return r}function N(t,e,f={}){let{format:r="rgb565",clearAlpha:o=!0,clearAlphaColor:i=0,clearAlphaThreshold:c=0,oneBitAlpha:l=!1}=f;if(!t||!t.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(t instanceof Uint8Array)&&!(t instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");let u=new Uint32Array(t.buffer),g=f.useSqrt!==!1,s=r==="rgba4444",n=xt(u,r),b=n.length,B=b-1,w=new Uint32Array(b+1);for(var y=0,x=0;x<b;++x){let v=n[x];if(v!=null){var p=1/v.cnt;s&&(v.ac*=p),v.rc*=p,v.gc*=p,v.bc*=p,n[y++]=v}}S(e)/y<.022&&(g=!1);for(var x=0;x<y-1;++x)n[x].fw=x+1,n[x+1].bk=x,g&&(n[x].cnt=Math.sqrt(n[x].cnt));g&&(n[x].cnt=Math.sqrt(n[x].cnt));var U,A,h;for(x=0;x<y;++x){et(n,x,!1);var M=n[x].err;for(A=++w[0];A>1&&(h=A>>1,!(n[U=w[h]].err<=M));A=h)w[A]=U;w[A]=x}var C=y-e;for(x=0;x<C;){for(var _;;){var k=w[1];if(_=n[k],_.tm>=_.mtm&&n[_.nn].mtm<=_.tm)break;_.mtm==B?k=w[1]=w[w[0]--]:(et(n,k,!1),_.tm=x);var M=n[k].err;for(A=1;(h=A+A)<=w[0]&&(h<w[0]&&n[w[h]].err>n[w[h+1]].err&&h++,!(M<=n[U=w[h]].err));A=h)w[A]=U;w[A]=k}var d=n[_.nn],z=_.cnt,E=d.cnt,p=1/(z+E);s&&(_.ac=p*(z*_.ac+E*d.ac)),_.rc=p*(z*_.rc+E*d.rc),_.gc=p*(z*_.gc+E*d.gc),_.bc=p*(z*_.bc+E*d.bc),_.cnt+=d.cnt,_.mtm=++x,n[d.bk].fw=d.fw,n[d.fw].bk=d.bk,d.mtm=B}let I=[];var R=0;for(x=0;;++R){let j=P(Math.round(n[x].rc),0,255),v=P(Math.round(n[x].gc),0,255),q=P(Math.round(n[x].bc),0,255),F=255;if(s){if(F=P(Math.round(n[x].ac),0,255),l){let ct=typeof l=="number"?l:127;F=F<=ct?0:255}o&&F<=c&&(j=v=q=i,F=0)}let W=s?[j,v,q,F]:[j,v,q];if(gt(I,W)||I.push(W),(x=n[x].fw)==0)break}return I}function gt(t,e){for(let f=0;f<t.length;f++){let r=t[f],o=r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2],i=r.length>=4&&e.length>=4?r[3]===e[3]:!0;if(o&&i)return!0}return!1}function K(t,e,f,r,o,i){let c=new Uint8ClampedArray(t),l=new Uint32Array(c.buffer),u=l.length,g=new Uint8Array(u),s=o==="rgb444"?4096:65536,n=new Array(s),b=[0,0,0],B=o==="rgb444"?D:T;i=i||[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]];let w=r.map(p=>{let x=p[0],U=p[1],A=p[2];return(p.length===4?p[3]:255)<<24|A<<16|U<<8|x}),y=o==="rgba4444";for(let p=0;p<u;p++){let x=Math.floor(p%e),U=Math.floor(p/e),A=l[p],h,M,C,_;if(y){a=A>>24&255,_=A>>16&255,C=A>>8&255,M=A&255;let d=G(M,C,_,a);h=d in n?n[d]:n[d]=L(M,C,_,a,r)}else{_=A>>16&255,C=A>>8&255,M=A&255;let d=B(M,C,_);h=d in n?n[d]:n[d]=Y(M,C,_,r)}g[p]=h;let k=r[h];b[0]=M-k[0],b[1]=C-k[1],b[2]=_-k[2],l[p]=w[h];for(let d=0;d<i.length;d++){let z=i[d],E=z[1]+x,I=z[2]+U;if(E>=0&&E<e&&I>=0&&I<f){let R=(E+I*e)*4,j=z[0];for(let v=0;v<3;v++){let q=v+R;c[q]=c[q]+b[v]*j}}}}return g}function O(t,e){return e>1?Math.round(t/e)*e:t}function nt(t,{roundRGB:e=5,roundAlpha:f=10,oneBitAlpha:r=null}={}){let o=new Uint32Array(t.buffer);for(let i=0;i<o.length;i++){let c=o[i],l=c>>24&255,u=c>>16&255,g=c>>8&255,s=c&255;if(l=O(l,f),r){let n=typeof r=="number"?r:127;l=l<=n?0:255}s=O(s,e),g=O(g,e),u=O(u,e),o[i]=l<<24|u<<16|g<<8|s<<0}}function rt(t,e,f="rgb565"){if(!t||!t.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(t instanceof Uint8Array)&&!(t instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");if(e.length>256)throw new Error("applyPalette() only works with 256 colors or less");let r=new Uint32Array(t.buffer),o=r.length,i=f==="rgb444"?4096:65536,c=new Uint8Array(o),l=f==="rgba4444"||f==="rgba8888";if(e=e.map(u=>l&&u.length<4?[u[0],u[1],u[2],255]:u),f==="rgba8888"||f==="rgb888")throw new Error("not yet supported");if(f==="rgba4444"){let u=new Array(i);for(let g=0;g<o;g++){let s=r[g],n=s>>24&255,b=s>>16&255,B=s>>8&255,w=s&255,y=G(w,B,b,n),p=y in u?u[y]:u[y]=L(w,B,b,n,e);c[g]=p}}else if(f==="rgb565"||f==="rgb444"){let u=new Array(i),g=f==="rgb444"?D:T;for(let s=0;s<o;s++){let n=r[s],b=n>>16&255,B=n>>8&255,w=n&255,y=g(w,B,b),p=y in u?u[y]:u[y]=Y(w,B,b,e);c[s]=p}}else throw new Error(`Invalid format ${f}`);return c}function ft(t={}){let{initialCapacity:e=4096,auto:f=!0}=t,r=V(e),o=5003,i=new Uint8Array(256),c=new Int32Array(o),l=new Int32Array(o),u=!1;return{reset(){r.reset(),u=!1},finish(){r.writeByte($.trailer)},bytes(){return r.bytes()},bytesView(){return r.bytesView()},get buffer(){return r.buffer},get stream(){return r},writeHeader:g,writeFrame(s,n,b,B={}){let{transparent:w=!1,transparentIndex:y=0,delay:p=0,palette:x=null,repeat:U=0,colorDepth:A=8,dispose:h=-1}=B,M=!1;if(f?u||(M=!0,g(),u=!0):M=Boolean(B.first),n=Math.max(0,Math.floor(n)),b=Math.max(0,Math.floor(b)),M){if(!x)throw new Error("First frame must include a { palette } option");ht(r,n,b,x,A),ot(r,x),U>=0&&dt(r,U)}let C=Math.round(p/10);bt(r,h,C,w,y);let _=Boolean(x)&&!M;wt(r,n,b,_?x:null),_&&ot(r,x),pt(r,s,n,b,A,i,c,l)}};function g(){it(r,"GIF89a")}}function bt(t,e,f,r,o){t.writeByte(33),t.writeByte(249),t.writeByte(4),o<0&&(o=0,r=!1);var i,c;r?(i=1,c=2):(i=0,c=0),e>=0&&(c=e&7),c<<=2;let l=0;t.writeByte(0|c|l|i),m(t,f),t.writeByte(o||0),t.writeByte(0)}function ht(t,e,f,r,o=8){let i=1,c=0,l=Z(r.length)-1,u=i<<7|o-1<<4|c<<3|l,g=0,s=0;m(t,e),m(t,f),t.writeBytes([u,g,s])}function dt(t,e){t.writeByte(33),t.writeByte(255),t.writeByte(11),it(t,"NETSCAPE2.0"),t.writeByte(3),t.writeByte(1),m(t,e),t.writeByte(0)}function ot(t,e){let f=1<<Z(e.length);for(let r=0;r<f;r++){let o=[0,0,0];r<e.length&&(o=e[r]),t.writeByte(o[0]),t.writeByte(o[1]),t.writeByte(o[2])}}function wt(t,e,f,r){if(t.writeByte(44),m(t,0),m(t,0),m(t,e),m(t,f),r){let o=0,i=0,c=Z(r.length)-1;t.writeByte(128|o|i|0|c)}else t.writeByte(0)}function pt(t,e,f,r,o=8,i,c,l){tt(f,r,e,o,t,i,c,l)}function m(t,e){t.writeByte(e&255),t.writeByte(e>>8&255)}function it(t,e){for(var f=0;f<e.length;f++)t.writeByte(e.charCodeAt(f))}function Z(t){return Math.max(Math.ceil(Math.log2(t)),1)}var yt=ft;
//# sourceMappingURL=gifenc.js.map
