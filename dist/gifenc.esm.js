var K=Object.defineProperty;var wt=t=>K(t,"__esModule",{value:!0});var dt=(t,e)=>()=>(e||(e={exports:{}},t(e.exports,e)),e.exports),yt=(t,e)=>{for(var o in e)K(t,o,{get:e[o],enumerable:!0})};var lt=dt(It=>{wt(It);yt(It,{colorDifferenceRGBToYIQ:()=>kt,colorDifferenceRGBToYIQSquared:()=>ft,colorDifferenceYIQ:()=>Ct,colorDifferenceYIQSquared:()=>it,euclideanDistance:()=>St,euclideanDistanceSquared:()=>ct});function nt(t,e,o){return t*.29889531+e*.58662247+o*.11448223}function rt(t,e,o){return t*.59597799-e*.2741761-o*.32180189}function ot(t,e,o){return t*.21147017-e*.52261711+o*.31114694}function it(t,e){let o=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],r=P(t)-P(e);return o*o*.5053+n*n*.299+i*i*.1957+r*r}function P(t){return t[3]!=null?t[3]:255}function Ct(t,e){return Math.sqrt(it(t,e))}function ft(t,e){let[o,n,i]=t,[r,f,c]=e,a=nt(o,n,i)-nt(r,f,c),x=rt(o,n,i)-rt(r,f,c),l=ot(o,n,i)-ot(r,f,c),s=P(t)-P(e);return a*a*.5053+x*x*.299+l*l*.1957+s*s}function kt(t,e){return Math.sqrt(ft(t,e))}function ct(t,e){var o=0,n;for(n=0;n<t.length;n++){let i=t[n]-e[n];o+=i*i}return o}function St(t,e){return Math.sqrt(ct(t,e))}});var J={signature:"GIF",version:"89a",trailer:59,extensionIntroducer:33,applicationExtensionLabel:255,graphicControlExtensionLabel:249,imageSeparator:44,signatureSize:3,versionSize:3,globalColorTableFlagMask:128,colorResolutionMask:112,sortFlagMask:8,globalColorTableSizeMask:7,applicationIdentifierSize:8,applicationAuthCodeSize:3,disposalMethodMask:28,userInputFlagMask:2,transparentColorFlagMask:1,localColorTableFlagMask:128,interlaceFlagMask:64,idSortFlagMask:32,localColorTableSizeMask:7};function E(t=256){let e=0,o=new Uint8Array(t);return{get buffer(){return o.buffer},reset(){e=0},bytesView(){return o.subarray(0,e)},bytes(){return o.slice(0,e)},writeByte(i){n(e+1),o[e]=i,e++},writeBytes(i,r=0,f=i.length){n(e+f);for(let c=0;c<f;c++)o[e++]=i[c+r]},writeBytesView(i,r=0,f=i.byteLength){n(e+f),o.set(i.subarray(r,r+f),e),e+=f}};function n(i){var r=o.length;if(r>=i)return;var f=1024*1024;i=Math.max(i,r*(r<f?2:1.125)>>>0),r!=0&&(i=Math.max(i,256));let c=o;o=new Uint8Array(i),e>0&&o.set(c.subarray(0,e),0)}}var j=12,$=5003,_t=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function Mt(t,e,o,n,i,r,f,c){i=i||E(512),r=r||new Uint8Array(256),f=f||new Int32Array($),c=c||new Int32Array($);let a=f.length,x=Math.max(2,n);r.fill(0),c.fill(0),m();let l=0,s=0,h=x+1,u=h,p=!1,y=u,g=q(y),v=1<<h-1,_=v+1,M=v+2,C=0,B=o[0],w=0;for(let b=a;b<65536;b*=2)++w;w=8-w,i.writeByte(x),S(v);for(let b=1;b<o.length;b++)F(o[b]);return S(B),S(_),i.writeByte(0),i.bytesView();function k(b){r[C++]=b,C>=254&&T()}function I(){m(),M=v+2,p=!0,S(v)}function m(){f.fill(-1)}function F(b){let z=(b<<j)+B,d=b<<w^B;if(f[d]===z)B=c[d];else{if(f[d]>=0){let G=d===0?1:a-d;do if(d-=G,d<0&&(d+=a),f[d]===z){B=c[d];return}while(f[d]>=0)}S(B),B=b,M<1<<j?(c[d]=M++,f[d]=z):I()}}function T(){C>0&&(i.writeByte(C),i.writeBytesView(r,0,C),C=0)}function q(b){return(1<<b)-1}function S(b){for(l&=_t[s],s>0?l|=b<<s:l=b,s+=y;s>=8;)k(l&255),l>>=8,s-=8;if((M>g||p)&&(p?(y=u,g=q(y),p=!1):(++y,y==j?g=1<<j:g=q(y))),b==_){for(;s>0;)k(l&255),l>>=8,s-=8;T()}}}var tt=Mt;function R(t,e,o){return t<<8&63488|e<<2&992|o>>3&31}function V(t,e,o,n){return t>>4|e&240|(o&240)<<4|(n&240)<<8}function L(t,e,o){return t>>4<<8|e>>4<<4|o>>4}function O(t,e,o){return t<e?e:t>o?o:t}function U(t){return t*t}function et(t,e,o){for(var n=0,i=1e100,r=t[e],f=r.cnt,c=r.ac,a=r.rc,x=r.gc,l=r.bc,s=r.fw;s!=0;s=t[s].fw){var h=t[s].cnt,u=f*h/(f+h);if(!(u>=i)){var p=0;o&&(p+=u*U(t[s].ac-c),p>=i)||(p+=u*U(t[s].rc-a),!(p>=i)&&(p+=u*U(t[s].gc-x),!(p>=i)&&(p+=u*U(t[s].bc-l),!(p>=i)&&(i=p,n=s))))}}r.err=i,r.nn=n}function H(){return{ac:0,rc:0,gc:0,bc:0,cnt:0,nn:0,fw:0,bk:0,tm:0,mtm:0,err:0}}function vt(t,e){let o=e==="rgb444"?4096:65536,n=new Array(o),i=t.length;if(e==="rgba4444")for(let r=0;r<i;++r){let f=t[r],c=f>>24&255,a=f>>16&255,x=f>>8&255,l=f&255,s=V(l,x,a,c),h=s in n?n[s]:n[s]=H();h.rc+=l,h.gc+=x,h.bc+=a,h.ac+=c,h.cnt++}else if(e==="rgb444")for(let r=0;r<i;++r){let f=t[r],c=f>>16&255,a=f>>8&255,x=f&255,l=L(x,a,c),s=l in n?n[l]:n[l]=H();s.rc+=x,s.gc+=a,s.bc+=c,s.cnt++}else for(let r=0;r<i;++r){let f=t[r],c=f>>16&255,a=f>>8&255,x=f&255,l=R(x,a,c),s=l in n?n[l]:n[l]=H();s.rc+=x,s.gc+=a,s.bc+=c,s.cnt++}return n}function N(t,e,o){let{format:n="rgb565",clearAlpha:i=!0,clearAlphaColor:r=0,clearAlphaThreshold:f=0,oneBitAlpha:c=!1}=o||{},a=o.useSqrt!==!1,x=n==="rgba4444",l=vt(t,n),s=l.length,h=s-1,u=new Uint32Array(s+1);for(var p=0,g=0;g<l.length;++g){let b=l[g];if(b!=null){var y=1/b.cnt;x&&(b.ac*=y),b.rc*=y,b.gc*=y,b.bc*=y,l[p++]=b}}U(e)/p<.022&&(a=!1);for(var g=0;g<p-1;++g)l[g].fw=g+1,l[g+1].bk=g,a&&(l[g].cnt=Math.sqrt(l[g].cnt));a&&(l[g].cnt=Math.sqrt(l[g].cnt));var v,_,M;for(g=0;g<p;++g){et(l,g,!1);var C=l[g].err;for(_=++u[0];_>1&&(M=_>>1,!(l[v=u[M]].err<=C));_=M)u[_]=v;u[_]=g}var B=p-e;for(g=0;g<B;){for(var w;;){var k=u[1];if(w=l[k],w.tm>=w.mtm&&l[w.nn].mtm<=w.tm)break;w.mtm==h?k=u[1]=u[u[0]--]:(et(l,k,!1),w.tm=g);var C=l[k].err;for(_=1;(M=_+_)<=u[0]&&(M<u[0]&&l[u[M]].err>l[u[M+1]].err&&M++,!(C<=l[v=u[M]].err));_=M)u[_]=v;u[_]=k}var I=l[w.nn],m=w.cnt,F=I.cnt,y=1/(m+F);x&&(w.ac=y*(m*w.ac+F*I.ac)),w.rc=y*(m*w.rc+F*I.rc),w.gc=y*(m*w.gc+F*I.gc),w.bc=y*(m*w.bc+F*I.bc),w.cnt+=I.cnt,w.mtm=++g,l[I.bk].fw=I.fw,l[I.fw].bk=I.bk,I.mtm=h}let T=[];var q=0;for(g=0;;++q){let S=O(Math.round(l[g].rc),0,255),b=O(Math.round(l[g].gc),0,255),z=O(Math.round(l[g].bc),0,255),d=255;if(x){if(d=O(Math.round(l[g].ac),0,255),c){let pt=typeof c=="number"?c:127;d=d<=pt?0:255}i&&d<=f&&(S=b=z=r,d=0)}let G=x?[S,b,z,d]:[S,b,z];if(Bt(T,G)||T.push(G),(g=l[g].fw)==0)break}return T}function Bt(t,e){for(let o=0;o<t.length;o++){let n=t[o],i=n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2],r=n.length>=4&&e.length>=4?n[3]===e[3]:!0;if(i&&r)return!0}return!1}var{euclideanDistanceSquared:Y}=lt();function Q(t,e){return e>1?Math.round(t/e)*e:t}function st(t,{roundRGB:e=5,roundAlpha:o=10,oneBitAlpha:n=null}={}){for(let i=0;i<t.length;i++){let r=t[i],f=r>>24&255,c=r>>16&255,a=r>>8&255,x=r&255;if(f=Q(f,o),n){let l=typeof n=="number"?n:127;f=f<=l?0:255}x=Q(x,e),a=Q(a,e),c=Q(c,e),t[i]=f<<24|c<<16|a<<8|x<<0}}function at(t,e,o){o=o||"rgb565";let n=o==="rgb444"?4096:65536,i=new Uint8Array(t.length),r=new Array(n),f=o==="rgba4444";if(o==="rgba4444")for(let c=0;c<t.length;c++){let a=t[c],x=a>>24&255,l=a>>16&255,s=a>>8&255,h=a&255,u=V(h,s,l,x),p;r[u]!=null?p=r[u]:(p=mt(h,s,l,x,e),r[u]=p),i[c]=p}else for(let c=0;c<t.length;c++){let a=t[c],x=a>>16&255,l=a>>8&255,s=a&255,h=o==="rgb444"?L(s,l,x):R(s,l,x),u;r[h]!=null?u=r[h]:(u=At(s,l,x,e),r[h]=u),i[c]=u}return i}function mt(t,e,o,n,i){let r=0,f=1e100;for(let c=0;c<i.length;c++){let a=i[c],x=a[0],l=a[1],s=a[2],h=a[3],u=D(h-n);u>f||(u+=D(x-t),!(u>f)&&(u+=D(l-e),!(u>f)&&(u+=D(s-o),!(u>f)&&(f=u,r=c))))}return r}function At(t,e,o,n){let i=0,r=1e100;for(let f=0;f<n.length;f++){let c=n[f],a=c[0],x=c[1],l=c[2],s=D(a-t);s>r||(s+=D(x-e),!(s>r)&&(s+=D(l-o),!(s>r)&&(r=s,i=f)))}return i}function ut(t,e,o=5){if(!t.length||!e.length)return;let n=t.map(f=>f.slice(0,3)),i=o*o,r=t[0].length;for(let f=0;f<e.length;f++){let c=e[f];c.length<r?c=[c[0],c[1],c[2],255]:c.length>r?c=c.slice(0,3):c=c.slice();let a=W(n,c.slice(0,3),Y),x=a[0],l=a[1];l>0&&l<=i&&(t[x]=c)}}function D(t){return t*t}function X(t,e,o=Y){let n=Infinity,i=-1;for(let r=0;r<t.length;r++){let f=t[r],c=o(e,f);c<n&&(n=c,i=r)}return i}function W(t,e,o=Y){let n=Infinity,i=-1;for(let r=0;r<t.length;r++){let f=t[r],c=o(e,f);c<n&&(n=c,i=r)}return[i,n]}function xt(t,e,o=Y){return t[X(t,e,o)]}function ht(t={}){let{initialCapacity:e=4096,auto:o=!0}=t,n=E(e),i=5003,r=new Uint8Array(256),f=new Int32Array(i),c=new Int32Array(i),a=!1;return{reset(){n.reset(),a=!1},finish(){n.writeByte(J.trailer)},bytes(){return n.bytes()},bytesView(){return n.bytesView()},get buffer(){return n.buffer},get stream(){return n},writeHeader:x,writeFrame(l,s,h,u={}){let{transparent:p=!1,transparentIndex:y=0,delay:g=0,palette:v=null,repeat:_=0,colorDepth:M=8,dispose:C=-1}=u,B=!1;if(o?a||(B=!0,x(),a=!0):B=Boolean(u.first),s=Math.max(0,Math.floor(s)),h=Math.max(0,Math.floor(h)),B){if(!v)throw new Error("First frame must include a { palette } option");zt(n,s,h,v,M),gt(n,v),_>=0&&Dt(n,_)}let w=Math.round(g/10);Ft(n,C,w,p,y);let k=Boolean(v)&&!B;Tt(n,s,h,k?v:null),k&&gt(n,v),qt(n,l,s,h,M,r,f,c)}};function x(){bt(n,"GIF89a")}}function Ft(t,e,o,n,i){t.writeByte(33),t.writeByte(249),t.writeByte(4),i<0&&(i=0,n=!1);var r,f;n?(r=1,f=2):(r=0,f=0),e>=0&&(f=e&7),f<<=2;let c=0;t.writeByte(0|f|c|r),A(t,o),t.writeByte(i||0),t.writeByte(0)}function zt(t,e,o,n,i=8){let r=1,f=0,c=Z(n.length)-1,a=r<<7|i-1<<4|f<<3|c,x=0,l=0;A(t,e),A(t,o),t.writeBytes([a,x,l])}function Dt(t,e){t.writeByte(33),t.writeByte(255),t.writeByte(11),bt(t,"NETSCAPE2.0"),t.writeByte(3),t.writeByte(1),A(t,e),t.writeByte(0)}function gt(t,e){let o=1<<Z(e.length);for(let n=0;n<o;n++){let i=[0,0,0];n<e.length&&(i=e[n]),t.writeByte(i[0]),t.writeByte(i[1]),t.writeByte(i[2])}}function Tt(t,e,o,n){if(t.writeByte(44),A(t,0),A(t,0),A(t,e),A(t,o),n){let i=0,r=0,f=Z(n.length)-1;t.writeByte(128|i|r|0|f)}else t.writeByte(0)}function qt(t,e,o,n,i=8,r,f,c){tt(o,n,e,i,t,r,f,c)}function A(t,e){t.writeByte(e&255),t.writeByte(e>>8&255)}function bt(t,e){for(var o=0;o<e.length;o++)t.writeByte(e.charCodeAt(o))}function Z(t){return Math.max(Math.ceil(Math.log2(t)),1)}var Et=ht;export{ht as GIFEncoder,at as applyPalette,ut as colorSnap,Et as default,xt as nearestColor,X as nearestColorIndex,W as nearestColorIndexWithDistance,st as prequantize,N as quantize};
//# sourceMappingURL=gifenc.esm.js.map
