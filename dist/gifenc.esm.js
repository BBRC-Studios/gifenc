var K={signature:"GIF",version:"89a",trailer:59,extensionIntroducer:33,applicationExtensionLabel:255,graphicControlExtensionLabel:249,imageSeparator:44,signatureSize:3,versionSize:3,globalColorTableFlagMask:128,colorResolutionMask:112,sortFlagMask:8,globalColorTableSizeMask:7,applicationIdentifierSize:8,applicationAuthCodeSize:3,disposalMethodMask:28,userInputFlagMask:2,transparentColorFlagMask:1,localColorTableFlagMask:128,interlaceFlagMask:64,idSortFlagMask:32,localColorTableSizeMask:7};function D(t=256){let e=0,l=new Uint8Array(t);return{get buffer(){return l.buffer},reset(){e=0},bytesView(){return l.subarray(0,e)},bytes(){return l.slice(0,e)},writeByte(r){n(e+1),l[e]=r,e++},writeBytes(r,o=0,i=r.length){n(e+i);for(let c=0;c<i;c++)l[e++]=r[c+o]},writeBytesView(r,o=0,i=r.byteLength){n(e+i),l.set(r.subarray(o,o+i),e),e+=i}};function n(r){var o=l.length;if(o>=r)return;var i=1024*1024;r=Math.max(r,o*(o<i?2:1.125)>>>0),o!=0&&(r=Math.max(r,256));let c=l;l=new Uint8Array(r),e>0&&l.set(c.subarray(0,e),0)}}var R=12,J=5003,st=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function at(t,e,l,n,r,o,i,c){r=r||D(512),o=o||new Uint8Array(256),i=i||new Int32Array(J),c=c||new Int32Array(J);let g=i.length,a=Math.max(2,n);o.fill(0),c.fill(0),I();let s=0,f=0,p=a+1,w=p,x=!1,d=w,y=F(d),u=1<<p-1,C=u+1,_=u+2,A=0,M=l[0],m=0;for(let b=g;b<65536;b*=2)++m;m=8-m,r.writeByte(a),T(u);for(let b=1;b<l.length;b++)q(l[b]);return T(M),T(C),r.writeByte(0),r.bytesView();function h(b){o[A++]=b,A>=254&&k()}function E(){I(),_=u+2,x=!0,T(u)}function I(){i.fill(-1)}function q(b){let v=(b<<R)+M,B=b<<m^M;if(i[B]===v)M=c[B];else{if(i[B]>=0){let S=B===0?1:g-B;do if(B-=S,B<0&&(B+=g),i[B]===v){M=c[B];return}while(i[B]>=0)}T(M),M=b,_<1<<R?(c[B]=_++,i[B]=v):E()}}function k(){A>0&&(r.writeByte(A),r.writeBytesView(o,0,A),A=0)}function F(b){return(1<<b)-1}function T(b){for(s&=st[f],f>0?s|=b<<f:s=b,f+=d;f>=8;)h(s&255),s>>=8,f-=8;if((_>y||x)&&(x?(d=w,y=F(d),x=!1):(++d,d==R?y=1<<R:y=F(d))),b==C){for(;f>0;)h(s&255),s>>=8,f-=8;k()}}}var $=at;function P(t,e,l){return t<<8&63488|e<<2&992|l>>3}function V(t,e,l,n){return t>>4|e&240|(l&240)<<4|(n&240)<<8}function L(t,e,l){return t>>4<<8|e&240|l>>4}function O(t,e,l){return t<e?e:t>l?l:t}function G(t){return t*t}function tt(t,e,l){for(var n=0,r=1e100,o=t[e],i=o.cnt,c=o.ac,g=o.rc,a=o.gc,s=o.bc,f=o.fw;f!=0;f=t[f].fw){var p=t[f].cnt,w=i*p/(i+p);if(!(w>=r)){var x=0;l&&(x+=w*G(t[f].ac-c),x>=r)||(x+=w*G(t[f].rc-g),!(x>=r)&&(x+=w*G(t[f].gc-a),!(x>=r)&&(x+=w*G(t[f].bc-s),!(x>=r)&&(r=x,n=f))))}}o.err=r,o.nn=n}function Q(){return{ac:0,rc:0,gc:0,bc:0,cnt:0,nn:0,fw:0,bk:0,tm:0,mtm:0,err:0}}function ut(t,e){let l=e==="rgb444"?4096:65536,n=new Array(l),r=t.length;if(e==="rgba4444")for(let o=0;o<r;++o){let i=t[o],c=i>>24&255,g=i>>16&255,a=i>>8&255,s=i&255,f=V(s,a,g,c),p=f in n?n[f]:n[f]=Q();p.rc+=s,p.gc+=a,p.bc+=g,p.ac+=c,p.cnt++}else if(e==="rgb444")for(let o=0;o<r;++o){let i=t[o],c=i>>16&255,g=i>>8&255,a=i&255,s=L(a,g,c),f=s in n?n[s]:n[s]=Q();f.rc+=a,f.gc+=g,f.bc+=c,f.cnt++}else for(let o=0;o<r;++o){let i=t[o],c=i>>16&255,g=i>>8&255,a=i&255,s=P(a,g,c),f=s in n?n[s]:n[s]=Q();f.rc+=a,f.gc+=g,f.bc+=c,f.cnt++}return n}function H(t,e,l={}){let{format:n="rgb565",clearAlpha:r=!0,clearAlphaColor:o=0,clearAlphaThreshold:i=0,oneBitAlpha:c=!1}=l;if(!t||!t.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(t instanceof Uint8Array)&&!(t instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");let g=new Uint32Array(t.buffer),a=l.useSqrt!==!1,s=n==="rgba4444",f=ut(g,n),p=f.length,w=p-1,x=new Uint32Array(p+1);for(var d=0,u=0;u<f.length;++u){let v=f[u];if(v!=null){var y=1/v.cnt;s&&(v.ac*=y),v.rc*=y,v.gc*=y,v.bc*=y,f[d++]=v}}G(e)/d<.022&&(a=!1);for(var u=0;u<d-1;++u)f[u].fw=u+1,f[u+1].bk=u,a&&(f[u].cnt=Math.sqrt(f[u].cnt));a&&(f[u].cnt=Math.sqrt(f[u].cnt));var C,_,A;for(u=0;u<d;++u){tt(f,u,!1);var M=f[u].err;for(_=++x[0];_>1&&(A=_>>1,!(f[C=x[A]].err<=M));_=A)x[_]=C;x[_]=u}var m=d-e;for(u=0;u<m;){for(var h;;){var E=x[1];if(h=f[E],h.tm>=h.mtm&&f[h.nn].mtm<=h.tm)break;h.mtm==w?E=x[1]=x[x[0]--]:(tt(f,E,!1),h.tm=u);var M=f[E].err;for(_=1;(A=_+_)<=x[0]&&(A<x[0]&&f[x[A]].err>f[x[A+1]].err&&A++,!(M<=f[C=x[A]].err));_=A)x[_]=C;x[_]=E}var I=f[h.nn],q=h.cnt,k=I.cnt,y=1/(q+k);s&&(h.ac=y*(q*h.ac+k*I.ac)),h.rc=y*(q*h.rc+k*I.rc),h.gc=y*(q*h.gc+k*I.gc),h.bc=y*(q*h.bc+k*I.bc),h.cnt+=I.cnt,h.mtm=++u,f[I.bk].fw=I.fw,f[I.fw].bk=I.bk,I.mtm=w}let F=[];var T=0;for(u=0;;++T){let b=O(Math.round(f[u].rc),0,255),v=O(Math.round(f[u].gc),0,255),B=O(Math.round(f[u].bc),0,255),S=255;if(s){if(S=O(Math.round(f[u].ac),0,255),c){let lt=typeof c=="number"?c:127;S=S<=lt?0:255}r&&S<=i&&(b=v=B=o,S=0)}let Z=s?[b,v,B,S]:[b,v,B];if(xt(F,Z)||F.push(Z),(u=f[u].fw)==0)break}return F}function xt(t,e){for(let l=0;l<t.length;l++){let n=t[l],r=n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2],o=n.length>=4&&e.length>=4?n[3]===e[3]:!0;if(r&&o)return!0}return!1}function j(t,e){var l=0,n;for(n=0;n<t.length;n++){let r=t[n]-e[n];l+=r*r}return l}function Y(t,e){return e>1?Math.round(t/e)*e:t}function et(t,{roundRGB:e=5,roundAlpha:l=10,oneBitAlpha:n=null}={}){let r=new Uint32Array(t.buffer);for(let o=0;o<r.length;o++){let i=r[o],c=i>>24&255,g=i>>16&255,a=i>>8&255,s=i&255;if(c=Y(c,l),n){let f=typeof n=="number"?n:127;c=c<=f?0:255}s=Y(s,e),a=Y(a,e),g=Y(g,e),r[o]=c<<24|g<<16|a<<8|s<<0}}function nt(t,e,l="rgb565"){if(!t||!t.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(t instanceof Uint8Array)&&!(t instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");if(e.length>256)throw new Error("applyPalette() only works with 256 colors or less");let n=new Uint32Array(t.buffer),r=n.length,o=l==="rgb444"?4096:65536,i=new Uint8Array(r),c=new Array(o),g=l==="rgba4444";if(l==="rgba4444")for(let a=0;a<r;a++){let s=n[a],f=s>>24&255,p=s>>16&255,w=s>>8&255,x=s&255,d=V(x,w,p,f),y=d in c?c[d]:c[d]=gt(x,w,p,f,e);i[a]=y}else{let a=l==="rgb444"?L:P;for(let s=0;s<r;s++){let f=n[s],p=f>>16&255,w=f>>8&255,x=f&255,d=a(x,w,p),y=d in c?c[d]:c[d]=pt(x,w,p,e);i[s]=y}}return i}function gt(t,e,l,n,r){let o=0,i=1e100;for(let c=0;c<r.length;c++){let g=r[c],a=g[3],s=U(a-n);if(s>i)continue;let f=g[0];if(s+=U(f-t),s>i)continue;let p=g[1];if(s+=U(p-e),s>i)continue;let w=g[2];s+=U(w-l),!(s>i)&&(i=s,o=c)}return o}function pt(t,e,l,n){let r=0,o=1e100;for(let i=0;i<n.length;i++){let c=n[i],g=c[0],a=U(g-t);if(a>o)continue;let s=c[1];if(a+=U(s-e),a>o)continue;let f=c[2];a+=U(f-l),!(a>o)&&(o=a,r=i)}return r}function rt(t,e,l=5){if(!t.length||!e.length)return;let n=t.map(i=>i.slice(0,3)),r=l*l,o=t[0].length;for(let i=0;i<e.length;i++){let c=e[i];c.length<o?c=[c[0],c[1],c[2],255]:c.length>o?c=c.slice(0,3):c=c.slice();let g=N(n,c.slice(0,3),j),a=g[0],s=g[1];s>0&&s<=r&&(t[a]=c)}}function U(t){return t*t}function W(t,e,l=j){let n=Infinity,r=-1;for(let o=0;o<t.length;o++){let i=t[o],c=l(e,i);c<n&&(n=c,r=o)}return r}function N(t,e,l=j){let n=Infinity,r=-1;for(let o=0;o<t.length;o++){let i=t[o],c=l(e,i);c<n&&(n=c,r=o)}return[r,n]}function ot(t,e,l=j){return t[W(t,e,l)]}function ct(t={}){let{initialCapacity:e=4096,auto:l=!0}=t,n=D(e),r=5003,o=new Uint8Array(256),i=new Int32Array(r),c=new Int32Array(r),g=!1;return{reset(){n.reset(),g=!1},finish(){n.writeByte(K.trailer)},bytes(){return n.bytes()},bytesView(){return n.bytesView()},get buffer(){return n.buffer},get stream(){return n},writeHeader:a,writeFrame(s,f,p,w={}){let{transparent:x=!1,transparentIndex:d=0,delay:y=0,palette:u=null,repeat:C=0,colorDepth:_=8,dispose:A=-1}=w,M=!1;if(l?g||(M=!0,a(),g=!0):M=Boolean(w.first),f=Math.max(0,Math.floor(f)),p=Math.max(0,Math.floor(p)),M){if(!u)throw new Error("First frame must include a { palette } option");dt(n,f,p,u,_),it(n,u),C>=0&&wt(n,C)}let m=Math.round(y/10);ht(n,A,m,x,d);let h=Boolean(u)&&!M;bt(n,f,p,h?u:null),h&&it(n,u),yt(n,s,f,p,_,o,i,c)}};function a(){ft(n,"GIF89a")}}function ht(t,e,l,n,r){t.writeByte(33),t.writeByte(249),t.writeByte(4),r<0&&(r=0,n=!1);var o,i;n?(o=1,i=2):(o=0,i=0),e>=0&&(i=e&7),i<<=2;let c=0;t.writeByte(0|i|c|o),z(t,l),t.writeByte(r||0),t.writeByte(0)}function dt(t,e,l,n,r=8){let o=1,i=0,c=X(n.length)-1,g=o<<7|r-1<<4|i<<3|c,a=0,s=0;z(t,e),z(t,l),t.writeBytes([g,a,s])}function wt(t,e){t.writeByte(33),t.writeByte(255),t.writeByte(11),ft(t,"NETSCAPE2.0"),t.writeByte(3),t.writeByte(1),z(t,e),t.writeByte(0)}function it(t,e){let l=1<<X(e.length);for(let n=0;n<l;n++){let r=[0,0,0];n<e.length&&(r=e[n]),t.writeByte(r[0]),t.writeByte(r[1]),t.writeByte(r[2])}}function bt(t,e,l,n){if(t.writeByte(44),z(t,0),z(t,0),z(t,e),z(t,l),n){let r=0,o=0,i=X(n.length)-1;t.writeByte(128|r|o|0|i)}else t.writeByte(0)}function yt(t,e,l,n,r=8,o,i,c){$(l,n,e,r,t,o,i,c)}function z(t,e){t.writeByte(e&255),t.writeByte(e>>8&255)}function ft(t,e){for(var l=0;l<e.length;l++)t.writeByte(e.charCodeAt(l))}function X(t){return Math.max(Math.ceil(Math.log2(t)),1)}var _t=ct;export{ct as GIFEncoder,nt as applyPalette,_t as default,ot as nearestColor,W as nearestColorIndex,N as nearestColorIndexWithDistance,et as prequantize,H as quantize,rt as snapColorsToPalette};
//# sourceMappingURL=gifenc.esm.js.map
